<!DOCTYPE html>
<html>
<head>
    <title>Сотрудники</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/4.0.9/jquery.inputmask.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        form[action="/employees"] {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        form[action="/employees"] label {
            font-weight: 600;
            color: #444;
        }
        form[action="/employees"] input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: auto;
        }
        form[action="/employees"] input[type="submit"] {
            padding: 8px 16px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        form[action="/employees"] input[type="submit"]:hover {
            background-color: #0056b3;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            border: 2px solid #ddd;
            font-family: Arial, sans-serif;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        th {
            background-color: #2185d0;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
        }
        tr {
            transition: all 0.2s ease;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #91d4f5;
            transform: scale(1.01);
        }
        .btn-edit, .btn-delete, .dropbtn, .profile-button, .employees-button, .logout-button, .add-button, .back-button, .phone-directory-button, .department-button, .position-button {
            border: none;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            font-size: 14px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-edit {
            background-color: #ffc107;
            color: #333;
        }
        .btn-edit:hover {
            background-color: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .btn-delete, .logout-button {
            background-color: #f44336;
            color: white;
        }
        .btn-delete:hover, .logout-button:hover {
            background-color: #d9251f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .dropbtn, .profile-button, .employees-button, .add-button, .back-button, .phone-directory-button, .department-button, .position-button {
            background-color: #007BFF;
            color: white;
        }
        .dropbtn:hover, .profile-button:hover, .employees-button:hover, .add-button:hover, .back-button:hover, .phone-directory-button:hover, .department-button:hover, .position-button:hover {
            background-color: #0eb3ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .dropdown {
            display: inline-block;
            position: relative;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 4px;
            transition: all 0.3s ease;
            transform-origin: top;
            opacity: 0;
            visibility: hidden;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.2s;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
            opacity: 1;
            visibility: visible;
            transform: scaleY(1);
        }
        form input[type="text"], form input[type="email"], form input[type="number"], form input[type="date"] {
            transition: border-color 0.3s, box-shadow 0.3s;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px;
            margin: 0 5px;
        }
        form input:focus {
            border-color: #2185d0;
            box-shadow: 0 0 5px rgba(33, 133, 208, 0.5);
            outline: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .edit-modal-content {
            background-color: #ffffff;
            margin: 8% auto;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
            animation: slideIn 0.3s ease-out;
            position: relative;
            border: 1px solid #e0e0e0;
        }
        .modal-content,
        .profile-modal-content,
        .department-modal-content,
        .position-modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            width: 50%;
            max-width: 600px;
            animation: slideIn 0.3s ease-out;
            position: relative;
        }
        .phone-directory-modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 1000px;
            min-width: 320px;
            animation: slideIn 0.3s ease-out;
            position: relative;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); }
            to { transform: translateY(0); }
        }
        .close-button {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            font-weight: bold;
            color: #888;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-button:hover {
            color: #333;
        }
        .edit-modal-form label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
            margin-top: 10px;
            margin-bottom: 5px;
            display: block;
        }
        .edit-modal-form input,
        .edit-modal-form select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s, box-shadow 0.3s;
            width: 100%;
            box-sizing: border-box;
        }
        .edit-modal-form input:focus,
        .edit-modal-form select:focus {
            border-color: #007BFF;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
            outline: none;
        }
        .modal-button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: block;
            margin: 20px auto 0;
        }
        .modal-button:hover {
            background-color: #0056b3;
        }
        .department-list, .position-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .department-list button, .position-list button {
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .department-list button:hover, .position-list button:hover {
            background-color: #0056b3;
        }
        .search-box {
            margin-bottom: 20px;
        }
        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .clear-filter {
            color: red;
            margin-left: 5px;
            cursor: pointer;
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
        }
        .phone-directory-table-container {
            overflow-x: auto;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .phone-directory-table-container table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            white-space: nowrap;
        }
        .phone-directory-table-container th,
        .phone-directory-table-container td {
            padding: 10px 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
        .phone-directory-table-container th {
            background-color: #2185d0;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12px;
        }
        .phone-directory-table-container td {
            background-color: #f9f9f9;
        }
        .phone-directory-table-container tr:hover td {
            background-color: #e3f2fd;
        }
    </style>
</head>
<body>
    <h1>Сотрудники</h1>
    <form action="/employees" method="get">
        <label for="full_name">ФИО:</label>
        <input type="text" name="full_name" id="full_name">
        <input type="submit" value="Поиск">
        <button type="button" class="back-button" onclick="window.location.href='/table'">Главная</button>
        <button type="button" class="add-button" onclick="window.location.href='/add_employee'">Добавить сотрудника</button>
        <button type="button" class="phone-directory-button" onclick="openPhoneDirectoryModal()">Телефонный справочник</button>
        <div style="display: inline-block; vertical-align: middle;">
            <button type="button" class="position-button" onclick="openPositionModal()">
                <span id="positionButtonText">Должность</span>
                <span id="clearPosition" class="clear-filter" style="display: none;" onclick="clearPositionFilter(event)">✕</span>
            </button>
        </div>
        <div style="display: inline-block; vertical-align: middle;">
            <button type="button" class="department-button" onclick="openDepartmentModal()">
                <span id="departmentButtonText">Отдел</span>
                <span id="clearDepartment" class="clear-filter" style="display: none;" onclick="clearDepartmentFilter(event)">✕</span>
            </button>
        </div>
    </form>
    <table>
        <tr>
            <th>ID</th>
            <th>Таб номер</th>
            <th>ФИО</th>
            <th>Дата рождения</th>
            <th>Пол</th>
            <th>Адрес</th>
            <th>Почта</th>
            <th>Серия и номер паспорта</th>
            <th>СНИЛС</th>
            <th>ИНН</th>
            <th>Дата приема на работу</th>
            <th>Должность</th>
            <th>Отдел</th>
            <th>Телефон</th>
            <th>Фото</th>
            <th>Действия</th>
        </tr>
        {% for employee in employees %}
        <tr>
            <td>{{ employee[0] }}</td>
            <td>{{ employee[1] }}</td>
            <td>{{ employee[2] }}</td>
            <td>{{ employee[3] }}</td>
            <td>{{ employee[4] }}</td>
            <td>{{ employee[5] }}</td>
            <td>{{ employee[6] }}</td>
            <td>{{ employee[7] }}</td>
            <td>{{ employee[8] }}</td>
            <td>{{ employee[9] }}</td>
            <td>{{ employee[10] }}</td>
            <td>{{ employee[11] }}</td>
            <td>{{ employee[12] }}</td>
            <td>{{ employee[13] }}</td>
            <td>
                {% if employee[14] %}
                <img src="{{ employee[14] }}" alt="Фото" style="max-width: 100px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                {% else %}
                Нет фото
                {% endif %}
            </td>
            <td>
                <button class="edit-button" onclick="openEditModal(this)">Редактировать</button>
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="edit-modal-content">
            <span class="close-button" onclick="closeEditModal()">&times;</span>
            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Редактировать сотрудника</h2>
            <form id="editForm" action="/edit_employee" method="post" enctype="multipart/form-data">
                <input type="hidden" id="employeeId" name="employee_id">
                <input type="hidden" id="existingPhoto" name="existing_photo">
                <label for="editEmployeeNumber">Табельный номер</label>
                <input type="text" id="editEmployeeNumber" name="employee_number" required placeholder="Например: 1001">
                <label for="editFullName">ФИО</label>
                <input type="text" id="editFullName" name="full_name" required placeholder="Иванов Иван Иванович">
                <label for="editBirthDate">Дата рождения</label>
                <input type="date" id="editBirthDate" name="birth_date" required>
                <label for="editGender">Пол</label>
                <select id="editGender" name="gender" required>
                    <option value="м">Мужской</option>
                    <option value="ж">Женский</option>
                </select>
                <label for="editAddress">Адрес</label>
                <input type="text" id="editAddress" name="address" required placeholder="г. Москва, ул. Ленина, д. 1">
                <label for="editEmail">Почта</label>
                <input type="email" id="editEmail" name="email" required placeholder="example@company.com">
                <label for="editPassport">Серия и номер паспорта</label>
                <input type="text" id="editPassport" name="passport_series_number" required placeholder="1234 567890">
                <label for="editSnils">СНИЛС</label>
                <input type="text" id="editSnils" name="snils" required placeholder="123-999-999 99">
                <label for="editInn">ИНН</label>
                <input type="text" id="editInn" name="inn" required placeholder="123456789012">
                <label for="editHireDate">Дата приёма на работу</label>
                <input type="date" id="editHireDate" name="hire_date" required>
                <label for="editPosition">Должность</label>
                <select id="editPosition" name="position" required>
                    <option value="Техник-программист">Техник-программист</option>
                    <option value="Инженер-программист">Инженер-программист</option>
                    <option value="Укладчик-упаковщик">Укладчик-упаковщик</option>
                    <option value="Механик">Механик</option>
                    <option value="Инженер-электроник">Инженер-электроник</option>
                    <option value="Слесарь-сантехник">Слесарь-сантехник</option>
                    <option value="Бухгалтер">Бухгалтер</option>
                </select>
                <label for="editDepartment">Отдел</label>
                <select id="editDepartment" name="department" required>
                    <option value="ОИТ">ОИТ</option>
                    <option value="Бухгалтерия">Бухгалтерия</option>
                    <option value="Канцелярия">Канцелярия</option>
                    <option value="КИП">КИП</option>
                    <option value="КО">КО</option>
                    <option value="МПС">МПС</option>
                    <option value="ОГМ">ОГМ</option>
                    <option value="ОГЭ">ОГЭ</option>
                    <option value="ОЗ">ОЗ</option>
                    <option value="ОК">ОК</option>
                    <option value="ОЛ">ОЛ</option>
                    <option value="ОП">ОП</option>
                    <option value="ОПБ">ОПБ</option>
                    <option value="ОР">ОР</option>
                    <option value="ОТК">ОТК</option>
                    <option value="ОУПС">ОУПС</option>
                    <option value="Охрана">Охрана</option>
                    <option value="ПСТ">ПСТ</option>
                    <option value="ПТО">ПТО</option>
                    <option value="Столовая">Столовая</option>
                    <option value="ТЛК">ТЛК</option>
                    <option value="ТЦ">ТЦ</option>
                    <option value="УПП">УПП</option>
                    <option value="УПУ">УПУ</option>
                    <option value="УТОиР">УТОиР</option>
                    <option value="УФК">УФК</option>
                    <option value="УЗО">УЗО</option>
                    <option value="ЦПШ">ЦПШ</option>
                    <option value="ЭЛ">ЭЛ</option>
                    <option value="ЭО">ЭО</option>
                    <option value="ЮО">ЮО</option>
                </select>
                <label for="editPhone">Телефон</label>
                <input type="text" id="editPhone" name="phone" required placeholder="+7 (999) 999-99-99">
                <label for="editPhoto">Фото (опционально)</label>
                <div id="editPhotoPreview" style="margin: 10px 0; text-align: center;">
                    <img id="editPhotoImage" src="" alt="Фото" style="max-width: 120px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);">
                </div>
                <input type="file" id="editPhoto" name="photo" accept="image/*" style="display: none;" onchange="updateFileName(this)">
                <button type="button" class="btn-edit" onclick="triggerFileInput()">Выбрать фото</button>
                <button type="submit" class="modal-button">Сохранить изменения</button>
            </form>
        </div>
    </div>

    <!-- Phone Directory Modal -->
    <div id="phoneDirectoryModal" class="modal">
        <div class="phone-directory-modal-content">
            <span class="close-button" onclick="closePhoneDirectoryModal()">&times;</span>
            <h2 style="text-align: center; color: #2c3e50;">Телефонный справочник</h2>
            <p style="text-align: center; color: #666; font-size: 14px;">Полный список сотрудников с контактами</p>
            <div style="display: flex; justify-content: flex-start; gap: 10px; margin-bottom: 15px;">
                <button type="button" class="back-button" onclick="closePhoneDirectoryModal()">Назад</button>
                <button type="button" class="add-button" onclick="window.location.href='/phone_directory'">Перейти к редактированию</button>
            </div>
            <div class="phone-directory-table-container">
                <table id="phoneDirTable">
                    <thead>
                        <tr>
                            <th>Таб номер</th>
                            <th>ФИО</th>
                            <th>Должность</th>
                            <th>Внутр.</th>
                            <th>Гор.</th>
                            <th>Сотовый</th>
                            <th>Дом.</th>
                            <th>E-Mail</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Phone Modal -->
    <div id="editPhoneModal" class="modal">
        <div class="edit-modal-content">
            <span class="close-button" onclick="closeEditPhoneModal()">&times;</span>
            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Изменить контактную информацию</h2>
            <form id="editPhoneForm" action="/update_phone_directory" method="post">
                <input type="hidden" id="editPhoneEmployeeNumber" name="employee_number">
                <label for="editPhoneFullName">ФИО</label>
                <input type="text" id="editPhoneFullName" name="full_name" readonly>
                <label for="editPhonePosition">Должность</label>
                <input type="text" id="editPhonePosition" name="position" readonly>
                <label for="editPhoneInternal">Внутренний телефон</label>
                <input type="text" id="editPhoneInternal" name="internal_phone">
                <label for="editPhoneCity">Городской телефон</label>
                <input type="text" id="editPhoneCity" name="city_phone">
                <label for="editPhoneMobile">Сотовый телефон</label>
                <input type="text" id="editPhoneMobile" name="mobile_phone">
                <label for="editPhoneHome">Домашний телефон</label>
                <input type="text" id="editPhoneHome" name="home_phone">
                <label for="editPhoneEmail">E-Mail</label>
                <input type="email" id="editPhoneEmail" name="email">
                <button type="submit" class="modal-button">Сохранить</button>
            </form>
        </div>
    </div>

    <!-- Department Modal -->
    <div id="departmentModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeDepartmentModal()">&times;</span>
            <h2 style="text-align: center; color: #2c3e50;">Выберите отдел</h2>
            <div class="search-box">
                <input type="text" id="departmentSearch" onkeyup="searchDepartment()" placeholder="Поиск отдела...">
            </div>
            <div class="department-list">
                <button type="button" onclick="filterByDepartment('ОИТ')">ОИТ</button>
                <button type="button" onclick="filterByDepartment('Бухгалтерия')">Бухгалтерия</button>
                <button type="button" onclick="filterByDepartment('Канцелярия')">Канцелярия</button>
                <button type="button" onclick="filterByDepartment('КИП')">КИП</button>
                <button type="button" onclick="filterByDepartment('КО')">КО</button>
                <button type="button" onclick="filterByDepartment('МПС')">МПС</button>
                <button type="button" onclick="filterByDepartment('ОГМ')">ОГМ</button>
                <button type="button" onclick="filterByDepartment('ОГЭ')">ОГЭ</button>
                <button type="button" onclick="filterByDepartment('ОЗ')">ОЗ</button>
                <button type="button" onclick="filterByDepartment('ОК')">ОК</button>
                <button type="button" onclick="filterByDepartment('ОЛ')">ОЛ</button>
                <button type="button" onclick="filterByDepartment('ОП')">ОП</button>
                <button type="button" onclick="filterByDepartment('ОПБ')">ОПБ</button>
                <button type="button" onclick="filterByDepartment('ОР')">ОР</button>
                <button type="button" onclick="filterByDepartment('ОТК')">ОТК</button>
                <button type="button" onclick="filterByDepartment('ОУПС')">ОУПС</button>
                <button type="button" onclick="filterByDepartment('Охрана')">Охрана</button>
                <button type="button" onclick="filterByDepartment('ПСТ')">ПСТ</button>
                <button type="button" onclick="filterByDepartment('ПТО')">ПТО</button>
                <button type="button" onclick="filterByDepartment('Столовая')">Столовая</button>
                <button type="button" onclick="filterByDepartment('ТЛК')">ТЛК</button>
                <button type="button" onclick="filterByDepartment('ТЦ')">ТЦ</button>
                <button type="button" onclick="filterByDepartment('УПП')">УПП</button>
                <button type="button" onclick="filterByDepartment('УПУ')">УПУ</button>
                <button type="button" onclick="filterByDepartment('УТОиР')">УТОиР</button>
                <button type="button" onclick="filterByDepartment('УФК')">УФК</button>
                <button type="button" onclick="filterByDepartment('УЗО')">УЗО</button>
                <button type="button" onclick="filterByDepartment('ЦПШ')">ЦПШ</button>
                <button type="button" onclick="filterByDepartment('ЭЛ')">ЭЛ</button>
                <button type="button" onclick="filterByDepartment('ЭО')">ЭО</button>
                <button type="button" onclick="filterByDepartment('ЮО')">ЮО</button>
            </div>
        </div>
    </div>

    <!-- Position Modal -->
    <div id="positionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closePositionModal()">&times;</span>
            <h2 style="text-align: center; color: #2c3e50;">Выберите должность</h2>
            <div class="search-box">
                <input type="text" id="positionSearch" onkeyup="searchPosition()" placeholder="Поиск должности...">
            </div>
            <div class="position-list">
                <button type="button" onclick="selectPosition('Техник-программист')">Техник-программист</button>
                <button type="button" onclick="selectPosition('Инженер-программист')">Инженер-программист</button>
                <button type="button" onclick="selectPosition('Укладчик-упаковщик')">Укладчик-упаковщик</button>
                <button type="button" onclick="selectPosition('Механик')">Механик</button>
                <button type="button" onclick="selectPosition('Инженер-электроник')">Инженер-электроник</button>
                <button type="button" onclick="selectPosition('Слесарь-сантехник')">Слесарь-сантехник</button>
                <button type="button" onclick="selectPosition('Бухгалтер')">Бухгалтер</button>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('#editPhone').inputmask('+7 (999) 999-99-99');
            $('#editPassport').inputmask('9999 999999');
            $('#editSnils').inputmask('999-999-999 99');
            $('#editInn').inputmask('999999999999');
        });

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        window.onload = function() {
            const department = getQueryParam('department');
            if (department) {
                document.getElementById('departmentButtonText').textContent = department;
                document.getElementById('clearDepartment').style.display = 'inline';
            }
            const position = getQueryParam('position');
            if (position) {
                document.getElementById('positionButtonText').textContent = position;
                document.getElementById('clearPosition').style.display = 'inline';
            }
        };

        function openEditModal(button) {
            var row = button.closest('tr');
            var employeeData = {
                id: row.cells[0].innerText,
                employeeNumber: row.cells[1].innerText,
                fullName: row.cells[2].innerText,
                birthDate: row.cells[3].innerText,
                gender: row.cells[4].innerText,
                address: row.cells[5].innerText,
                email: row.cells[6].innerText,
                passport: row.cells[7].innerText,
                snils: row.cells[8].innerText,
                inn: row.cells[9].innerText,
                hireDate: row.cells[10].innerText,
                position: row.cells[11].innerText,
                department: row.cells[12].innerText,
                phone: row.cells[13].innerText,
                photo: row.cells[14].querySelector('img') ? row.cells[14].querySelector('img').src : ''
            };
            document.getElementById('editModal').style.display = 'block';
            document.getElementById('employeeId').value = employeeData.id;
            document.getElementById('editEmployeeNumber').value = employeeData.employeeNumber;
            document.getElementById('editFullName').value = employeeData.fullName;
            document.getElementById('editBirthDate').value = employeeData.birthDate;
            document.getElementById('editGender').value = employeeData.gender;
            document.getElementById('editAddress').value = employeeData.address;
            document.getElementById('editEmail').value = employeeData.email;
            document.getElementById('editPassport').value = employeeData.passport;
            document.getElementById('editSnils').value = employeeData.snils;
            document.getElementById('editInn').value = employeeData.inn;
            document.getElementById('editHireDate').value = employeeData.hireDate;
            document.getElementById('editPosition').value = employeeData.position;
            document.getElementById('editDepartment').value = employeeData.department;
            document.getElementById('editPhone').value = employeeData.phone;
            document.getElementById('existingPhoto').value = employeeData.photo;
            var photoImage = document.getElementById('editPhotoImage');
            if (employeeData.photo) {
                photoImage.src = employeeData.photo;
            } else {
                photoImage.src = '';
                photoImage.alt = 'Нет фото';
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function triggerFileInput() {
            document.getElementById('editPhoto').click();
        }

        function updateFileName(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('editPhotoImage').src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function openDepartmentModal() {
            document.getElementById('departmentModal').style.display = 'block';
        }

        function closeDepartmentModal() {
            document.getElementById('departmentModal').style.display = 'none';
        }

        function filterByDepartment(department) {
            document.getElementById('departmentButtonText').textContent = department;
            document.getElementById('clearDepartment').style.display = 'inline';
            window.location.href = `/employees?department=${encodeURIComponent(department)}`;
            closeDepartmentModal();
        }

        function clearDepartmentFilter(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('departmentButtonText').textContent = 'Отдел';
            document.getElementById('clearDepartment').style.display = 'none';
            window.location.href = '/employees';
        }

        function openPositionModal() {
            document.getElementById('positionModal').style.display = 'block';
        }

        function closePositionModal() {
            document.getElementById('positionModal').style.display = 'none';
        }

        function selectPosition(position) {
            document.getElementById('positionButtonText').textContent = position;
            document.getElementById('clearPosition').style.display = 'inline';
            window.location.href = `/employees?position=${encodeURIComponent(position)}`;
            closePositionModal();
        }

        function clearPositionFilter(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('positionButtonText').textContent = 'Должность';
            document.getElementById('clearPosition').style.display = 'none';
            window.location.href = '/employees';
        }

        function openPhoneDirectoryModal() {
            fetch('/get_phone_directory')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.querySelector('#phoneDirTable tbody');
                    tbody.innerHTML = '';
                    if (data.length === 0) {
                        tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 20px; color: #999;">Нет данных</td></tr>`;
                        return;
                    }
                    data.forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${entry.employee_number || ''}</td>
                            <td>${entry.full_name || ''}</td>
                            <td>${entry.position || ''}</td>
                            <td>${entry.internal_phone || ''}</td>
                            <td>${entry.city_phone || ''}</td>
                            <td>${entry.mobile_phone || ''}</td>
                            <td>${entry.home_phone || ''}</td>
                            <td>${entry.email || ''}</td>
                            <td>
                                <button class="btn-edit" onclick="openEditPhoneModal('${entry.employee_number}')">
                                    ✏️
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(err => {
                    console.error('Ошибка загрузки справочника:', err);
                    document.querySelector('#phoneDirTable tbody').innerHTML =
                        `<tr><td colspan="9" style="color: red; text-align: center;">Ошибка</td></tr>`;
                });
            document.getElementById('phoneDirectoryModal').style.display = 'block';
        }

        function closePhoneDirectoryModal() {
            document.getElementById('phoneDirectoryModal').style.display = 'none';
        }

        function openEditPhoneModal(employeeNumber) {
            fetch(`/get_phone_directory?employee_number=${employeeNumber}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const entry = data[0];
                        document.getElementById('editPhoneEmployeeNumber').value = entry.employee_number;
                        document.getElementById('editPhoneFullName').value = entry.full_name;
                        document.getElementById('editPhonePosition').value = entry.position;
                        document.getElementById('editPhoneInternal').value = entry.internal_phone;
                        document.getElementById('editPhoneCity').value = entry.city_phone;
                        document.getElementById('editPhoneMobile').value = entry.mobile_phone;
                        document.getElementById('editPhoneHome').value = entry.home_phone;
                        document.getElementById('editPhoneEmail').value = entry.email;
                    }
                })
                .catch(err => console.error('Ошибка:', err));
            document.getElementById('editPhoneModal').style.display = 'block';
        }

        function closeEditPhoneModal() {
            document.getElementById('editPhoneModal').style.display = 'none';
        }

        function searchDepartment() {
            const input = document.getElementById('departmentSearch');
            const filter = input.value.toUpperCase();
            const buttons = document.querySelectorAll('.department-list button');
            buttons.forEach(btn => {
                const text = btn.textContent.toUpperCase();
                btn.style.display = text.includes(filter) ? '' : 'none';
            });
        }

        function searchPosition() {
            const input = document.getElementById('positionSearch');
            const filter = input.value.toUpperCase();
            const buttons = document.querySelectorAll('.position-list button');
            buttons.forEach(btn => {
                const text = btn.textContent.toUpperCase();
                btn.style.display = text.includes(filter) ? '' : 'none';
            });
        }
    </script>
</body>
</html>